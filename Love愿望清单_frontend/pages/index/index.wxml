<!--index.wxml-->
<scroll-view class="scrollarea" scroll-y type="list">
  <view class="container">
    <view class="userinfo">
      <block wx:if="{{canIUseNicknameComp && !hasUserInfo}}">
        <button class="avatar-wrapper" open-type="chooseAvatar" bind:chooseavatar="onChooseAvatar">
          <image class="avatar" src="{{userInfo.avatarUrl}}"></image>
        </button>
        <view class="nickname-wrapper">
          <text class="nickname-label">昵称</text>
          <input type="nickname" class="nickname-input" placeholder="请输入昵称" bind:change="onInputChange" />
        </view>
      </block>
      <block wx:elif="{{!hasUserInfo}}">
        <button wx:if="{{canIUseGetUserProfile}}" bindtap="getUserProfile"> 获取头像昵称 </button>
        <view wx:else> 请使用2.10.4及以上版本基础库 </view>
      </block>
      <block wx:else>
        <image bindtap="bindViewTap" class="userinfo-avatar" src="{{userInfo.avatarUrl}}" mode="cover"></image>
        <text class="userinfo-nickname">{{userInfo.nickName}}</text>
      </block>
    </view>
    <view class="usermotto">
      <text class="user-motto">{{motto}}</text>
    </view>
  </view>
</scroll-view>

<view class="index-container">
  <!-- 顶部情侣信息卡片 -->
  <view class="couple-card card">
    <block wx:if="{{relationInfo.status === 'ACTIVE'}}">
      <view class="couple-info flex items-center justify-between">
        <view class="user-avatar-box">
          <image class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"/>
          <text class="nickname">{{userInfo.nickName}}</text>
        </view>
        <view class="love-days flex-col items-center">
          <text class="days">{{relationInfo.days}}</text>
          <text class="label">相恋天数</text>
        </view>
        <view class="user-avatar-box">
          <image class="avatar" src="{{partnerInfo.avatarUrl}}" mode="aspectFill"/>
          <text class="nickname">{{partnerInfo.nickName}}</text>
        </view>
      </view>
    </block>
    <block wx:else>
      <view class="no-match flex-col items-center">
        <image class="empty-img" src="/assets/images/no-match.png" mode="aspectFit"/>
        <text class="tips">还没有匹配到另一半哦</text>
        <button class="btn" bindtap="goToMatch">去匹配</button>
      </view>
    </block>
  </view>

  <!-- 每日情话卡片 -->
  <view class="love-card card">
    <view class="card-header flex justify-between items-center">
      <text class="title">今日情话</text>
      <text class="from">{{dailyLove.from}}</text>
    </view>
    <view class="love-content">{{dailyLove.content}}</view>
  </view>

  <!-- 近期纪念日 -->
  <view class="anniversary-card card">
    <view class="card-header flex justify-between items-center">
      <text class="title">近期纪念日</text>
      <navigator url="/pages/anniversary/index" class="more">
        查看全部
        <van-icon name="arrow" />
      </navigator>
    </view>
    <view class="anniversary-list">
      <view 
        class="anniversary-item flex justify-between items-center"
        wx:for="{{recentAnniversaries}}"
        wx:key="id"
        data-id="{{item.id}}"
        bindtap="goToAnniversaryDetail"
      >
        <view class="flex items-center">
          <view class="type-icon {{item.type}}"></view>
          <view class="info">
            <view class="name">{{item.title}}</view>
            <view class="date">{{item.date}}</view>
          </view>
        </view>
        <view class="days-left">
          <text class="num">{{item.daysLeft}}</text>
          <text class="unit">天</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 愿望进度 -->
  <view class="wish-card card">
    <view class="card-header flex justify-between items-center">
      <text class="title">愿望进度</text>
      <navigator url="/pages/wish/index" class="more">
        查看全部
        <van-icon name="arrow" />
      </navigator>
    </view>
    <view class="progress-box">
      <view class="progress-info flex justify-between">
        <text>完成进度</text>
        <text>{{wishProgress.rate}}</text>
      </view>
      <view class="progress-bar">
        <view class="progress" style="width:{{wishProgress.rate}}"></view>
      </view>
      <view class="progress-detail flex justify-between">
        <text>已完成 {{wishProgress.completed}}</text>
        <text>总计 {{wishProgress.total}}</text>
      </view>
    </view>
  </view>
</view>
