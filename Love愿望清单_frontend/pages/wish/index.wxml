<view class="wish-container">
  <!-- 顶部背景 -->
  <view class="bg-gradient"></view>

  <!-- 头部区域 -->
  <view class="header">
    <view class="title-section">
      <text class="main-title">愿望清单</text>
      <text class="sub-title">记录美好，实现梦想</text>
    </view>
    <view class="add-btn-wrapper">
      <view class="add-btn" bindtap="showAddPopup">
        <van-icon name="plus" color="#fff" size="24px" />
      </view>
    </view>
  </view>

  <!-- 愿望列表 -->
  <view class="wish-list">
    <view class="loading-container" wx:if="{{ loading }}">
      <van-loading type="spinner" color="#FF69B4" size="24px">加载中...</van-loading>
    </view>
    <block wx:elif="{{ wishList && wishList.length > 0 }}">
      <view 
        class="wish-card {{ item.status === 1 ? 'completed' : '' }}" 
        wx:for="{{ wishList }}" 
        wx:key="id"
        bindtap="showDetailPopup"
        data-item="{{ item }}"
      >
        <view class="wish-content">
          <view class="wish-header">
            <view class="wish-title">{{ item.title }}</view>
            <view class="wish-status {{ item.status === 1 ? 'completed' : '' }}">
              {{ item.status === 1 ? '已完成' : '进行中' }}
            </view>
          </view>
          <view class="wish-desc" wx:if="{{ item.description }}">{{ item.description }}</view>
          <view class="wish-image" wx:if="{{ item.imageUrl }}">
            <image src="{{ item.imageUrl }}" mode="aspectFill"></image>
          </view>
          <view class="wish-footer">
            <view class="wish-time">{{ item.createTime }}</view>
            <view class="wish-actions">
              <view class="action-btn complete" catchtap="toggleWishStatus" data-id="{{ item.id }}" data-status="{{ item.status }}">
                <van-icon name="{{ item.status === 1 ? 'success' : 'circle' }}" />
                <text>{{ item.status === 1 ? '已完成' : '完成' }}</text>
              </view>
              <view class="action-btn edit" catchtap="editWish" data-item="{{ item }}">
                <van-icon name="edit" />
                <text>编辑</text>
              </view>
              <view class="action-btn delete" catchtap="deleteWish" data-id="{{ item.id }}">
                <van-icon name="delete" />
                <text>删除</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </block>
    <view class="empty-container" wx:else>
      <image class="empty-image" src="/static/images/empty.png" mode="aspectFit"></image>
      <view class="empty-text">
        <text class="empty-title">还没有愿望清单~</text>
        <text class="empty-desc">点击右上角的"+"添加你的第一个愿望吧</text>
      </view>
      <view class="add-first-btn" bindtap="showAddPopup">
        <van-icon name="plus" />
        <text>添加愿望</text>
      </view>
    </view>
  </view>

  <!-- 添加愿望弹窗 -->
  <van-popup
    show="{{ showAddPopup }}"
    round
    position="bottom"
    bind:close="onCloseAddPopup"
    custom-style="min-height: 65%"
  >
    <view class="popup-content">
      <view class="popup-header">
        <view class="popup-title-section">
          <text class="popup-title">{{ editingWish ? '编辑愿望' : '添加愿望' }}</text>
          <text class="popup-subtitle">记录下你的美好愿望吧</text>
        </view>
        <view class="popup-close" bindtap="onCloseAddPopup">
          <van-icon name="cross" size="44rpx" color="#999" />
        </view>
      </view>
      
      <view class="form-content">
        <view class="form-item">
          <view class="form-label">
            <van-icon name="edit" color="#FF69B4" size="36rpx" />
            <text>标题</text>
          </view>
          <input 
            class="form-input"
            value="{{ newWish.title }}"
            placeholder="请输入愿望标题"
            maxlength="50"
            bindinput="onTitleInput"
          />
          <text class="input-count">{{ newWish.title.length }}/50</text>
        </view>

        <view class="form-item">
          <view class="form-label">
            <van-icon name="description" color="#FF69B4" size="36rpx" />
            <text>描述</text>
          </view>
          <textarea 
            class="form-textarea"
            value="{{ newWish.description }}"
            placeholder="请输入愿望描述"
            maxlength="200"
            bindinput="onDescInput"
          />
          <text class="input-count">{{ newWish.description.length }}/200</text>
        </view>

        <view class="form-item">
          <view class="form-label">
            <van-icon name="photo" color="#FF69B4" size="36rpx" />
            <text>图片</text>
          </view>
          <view class="upload-content">
            <view class="image-preview" wx:if="{{ tempImageUrl }}">
              <image src="{{ tempImageUrl }}" mode="aspectFill"></image>
              <view class="delete-image" catchtap="deleteImage">
                <van-icon name="cross" color="#fff" size="32rpx" />
              </view>
            </view>
            <view class="upload-btn" bindtap="chooseImage" wx:else>
              <van-icon name="plus" size="48rpx" color="#999" />
              <text>上传图片</text>
            </view>
          </view>
        </view>
      </view>

      <view class="popup-footer">
        <button class="footer-btn cancel-btn" bindtap="onCloseAddPopup">
          <van-icon name="close" />
          <text>取消</text>
        </button>
        <button class="footer-btn confirm-btn" bindtap="onConfirmAdd">
          <van-icon name="success" />
          <text>确定</text>
        </button>
      </view>
    </view>
  </van-popup>
</view> 